"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const fs_1 = require("fs");
const js_yaml_1 = require("js-yaml");
const schema_resource_loader_1 = require("./loaders/schema-resource-loader");
const defaultResourceLoader = (x) => x;
const resourceLoaders = {
    Schema: schema_resource_loader_1.default,
};
async function default_1(resourceFile, resourceTypesToSkip) {
    const resourceFileContent = await fs_1.promises.readFile(resourceFile, { encoding: 'utf8' });
    const resourceContents = js_yaml_1.safeLoadAll(resourceFileContent);
    const resources = {};
    for (const resourceWithKind of resourceContents) {
        const { kind, ...resource } = resourceWithKind;
        if (resourceTypesToSkip?.includes(kind))
            continue;
        if (!resources[kind])
            resources[kind] = [];
        // We don't bother validating the resources, since GraphQL provides a strong enough validation
        // Client-side validation can be added later on to not require a server hop
        const loadedResource = await (resourceLoaders[kind] ?? defaultResourceLoader)(resource, resourceFile);
        resources[kind].push(loadedResource);
    }
    return resources;
}
exports.default = default_1;
